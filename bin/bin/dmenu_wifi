#!/bin/sh
#
# Select a wifi network and connect to it.

. "$HOME"/.rc.d/wifi.sh

selection=$(iwctl station wlan0 get-networks rssi-dbms | \
	            ansifilter | \
	            tail -n +5 | \
	            head -n -1 | \
				dmenu -p 'Select network: ' -l 10)

if [ $? -ne 0 ]; then
	notify-send Cancelled
	exit 0
fi

network=$(echo "$selection" | \
	           # remove leading spaces and any '>'
	          sed 's/^[^[:alnum:]]*//' | \
	          awk -F '  +' '{ print $1 }')

if wifi "$network"; then
	notify-send "Connected to $network"
else
	notify-send "‚ùå Unable to connect to $network"
	exit 1
fi
