#!/bin/sh
#
# Connect to or disconnect from an external monitor.
#
# NOTE: Assumes the external monitor is connected via DisplayPort and is
# therefore named DP1.

_is_connected() {
	xrandr --query | grep "^$1 connected" >/dev/null
}

_switch() {
	_is_connected "$1" && xrandr --output "$1" --off
	xrandr --output "$2" --auto --primary

	if bspc query --monitors --names | grep "$1" >/dev/null; then
		bspc monitor "$1" --remove
	fi
	bspc monitor "$2" --reset-desktops 1 2 3 4
	bspc wm --adopt-orphans

	# Restart panel and desktop wallpaper so they pick up the new screen
	# resolution.
	melonpanel
	"$HOME/.fehbg"
}

case $1 in
	connect)
		_is_connected DP1 && _switch LVDS1 DP1
		;;
	disconnect)
		_switch DP1 LVDS1
		;;
	*)
		echo "Usage: $0 connect|disconnect" >&2
		exit 1
		;;
esac
