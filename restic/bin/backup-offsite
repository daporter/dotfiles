#!/bin/sh
#
# Run an offsite backup of my home directory.

set -o errexit                  # abort on nonzero exitstatus
set -o nounset                  # abort on unbound variable

MOUNTPOINT=/run/media/david/offsite-backup

if ! findmnt $MOUNTPOINT > /dev/null; then
	echo Error: $MOUNTPOINT not mounted
	exit 1
fi

echo "* Backing up restic"
rsync --archive          \
      --delete           \
      --verbose          \
      /mnt/backup        \
      $MOUNTPOINT/

touch $MOUNTPOINT/.last_backup

sync
udiskie-umount $MOUNTPOINT
